d-xl p-6 border border-purple-100">
                   <h4 class="text-xl font-semibold text-gray-800 mb-3 flex items-center">
                       <i class="fas fa-user-md text-purple-600 mr-2"></i>
                       Especialidade Recomendada
                   </h4>
                   <div class="flex items-center justify-between">
                       <div>
                           <p class="text-lg text-purple-800 font-medium">${specialties[analysis.specialty]}</p>
                           <p class="text-sm text-gray-600 mt-1">Baseado na análise dos seus sintomas</p>
                       </div>
                       <div class="text-purple-600 text-3xl">
                           <i class="fas fa-stethoscope"></i>
                       </div>
                   </div>
               </div>
           `;

           // Recomendações Personalizadas
           const recommendationsList = analysis.recommendations
               .map(rec => `<li class="flex items-start"><i class="fas fa-check-circle text-green-500 mr-3 mt-1 flex-shrink-0"></i><span>${rec}</span></li>`)
               .join("");

           document.getElementById("personalizedRecommendations").innerHTML = `
               <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
                   <h4 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                       <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                       Recomendações Personalizadas
                   </h4>
                   <ul class="space-y-3">
                       ${recommendationsList}
                   </ul>
                   <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                       <p class="text-sm text-blue-800">
                           <i class="fas fa-info-circle mr-2"></i>
                           Análise realizada em ${analysis.analysisDate} • Esta análise não substitui uma consulta médica presencial
                       </p>
                   </div>
               </div>
           `;

           // Scroll para os resultados
           document.getElementById("resultsPanel").scrollIntoView({ behavior: "smooth" });
       }

       function scheduleAppointment() {
           const analysisData = encodeURIComponent(JSON.stringify(chatState));
           showNotification('Redirecionando para agendamento...', 'info');

           setTimeout(() => {
               window.location.href = `index.html?ai_analysis=${analysisData}`;
           }, 1500);
       }

       function downloadReport() {
           try {
               const analysis = analyzeSymptoms();
               const reportContent = generatePDFReport(analysis);

               // Criar blob e download
               const blob = new Blob([reportContent], { type: 'text/plain' });
               const url = window.URL.createObjectURL(blob);
               const a = document.createElement('a');
               a.style.display = 'none';
               a.href = url;
               a.download = `relatorio-dr-ai-${new Date().toISOString().split('T')[0]}.txt`;
               document.body.appendChild(a);
               a.click();
               window.URL.revokeObjectURL(url);
               document.body.removeChild(a);

               showNotification('Relatório baixado com sucesso!', 'success');
           } catch (error) {
               showNotification('Erro ao gerar relatório', 'error');
           }
       }

       function generatePDFReport(analysis) {
           const date = new Date().toLocaleDateString('pt-BR');
           const time = new Date().toLocaleTimeString('pt-BR');

           return `
RELATÓRIO DE ANÁLISE - DR. AI
===============================

Data: ${date}
Hora: ${time}

DADOS DO PACIENTE
-----------------
Sintoma Principal: ${chatState.symptoms[0]}
Intensidade: ${chatState.intensity}/10
Duração: ${chatState.duration}
Fatores Desencadeantes: ${chatState.triggers[0]}
Histórico Médico: ${chatState.medicalHistory[0]}

ANÁLISE DA IA
-------------
Nível de Risco: ${analysis.riskLevel === 'low' ? 'Baixo' : analysis.riskLevel === 'medium' ? 'Moderado' : 'Alto'}
Especialidade Recomendada: ${specialties[analysis.specialty]}
Confiança da Análise: ${analysis.confidence}%

RECOMENDAÇÕES
-------------
${analysis.recommendations.map((rec, index) => `${index + 1}. ${rec.replace(/[🚨🚫👥📞⏰📊💊📝📅🌡️💧😴]/g, '')}`).join('\n')}

AVISO IMPORTANTE
----------------
Esta análise foi gerada por inteligência artificial e tem caráter informativo.
NÃO substitui uma consulta médica presencial.
Em caso de emergência, procure atendimento médico imediatamente.

TeleMed Pro - Sistema de Triagem Inteligente
           `;
       }

       function newAnalysis() {
           // Reset do estado do chat
           chatState = {
               step: 1,
               maxSteps: 5,
               symptoms: [],
               intensity: "",
               duration: "",
               triggers: [],
               medicalHistory: [],
               currentSymptom: "",
               analysisComplete: false
           };

           // Limpar chat
           document.getElementById("chatMessages").innerHTML = `
               <div class="chat-message">
                   <div class="flex items-start">
                       <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                           <i class="fas fa-robot text-white text-sm"></i>
                       </div>
                       <div class="bg-blue-50 rounded-lg p-3 max-w-xs lg:max-w-md">
                           <p class="text-sm text-gray-800">Olá! Sou o Dr. AI, seu assistente de triagem inteligente. Vou ajudá-lo a analisar seus sintomas e recomendar o melhor tipo de atendimento. Como você está se sentindo hoje?</p>
                       </div>
                   </div>
               </div>
           `;

           // Esconder resultados
           document.getElementById("resultsPanel").classList.add("hidden");

           // Reset progress
           updateProgress();

           // Scroll para o topo
           window.scrollTo({ top: 0, behavior: "smooth" });

           showNotification('Nova análise iniciada', 'info');
       }

       function openTriagePsychiatric() {
           if (confirm('Deseja acessar a triagem psiquiátrica especializada?')) {
               window.location.href = 'triagem-psiquiatrica.html';
           }
       }

       function goBack() {
           if (chatState.step > 1 || chatState.analysisComplete) {
               if (confirm('Tem certeza que deseja sair? Sua análise atual será perdida.')) {
                   window.location.href = 'index.html';
               }
           } else {
               window.location.href = 'index.html';
           }
       }

       // Sistema de notificações
       function showNotification(message, type = 'info') {
           const toast = document.getElementById('notificationToast');
           const colors = {
               success: 'bg-green-500',
               error: 'bg-red-500',
               info: 'bg-blue-500',
               warning: 'bg-yellow-500'
           };

           const icons = {
               success: 'fa-check-circle',
               error: 'fa-exclamation-circle',
               info: 'fa-info-circle',
               warning: 'fa-exclamation-triangle'
           };

           toast.className = `fixed top-4 right-4 z-50 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 transform translate-x-full transition-transform duration-300`;
           toast.innerHTML = `
               <i class="fas ${icons[type]}"></i>
               <span>${message}</span>
           `;

           // Mostrar
           toast.classList.remove('hidden');
           setTimeout(() => {
               toast.classList.remove('translate-x-full');
           }, 100);

           // Esconder após 4 segundos
           setTimeout(() => {
               toast.classList.add('translate-x-full');
               setTimeout(() => {
                   toast.classList.add('hidden');
               }, 300);
           }, 4000);
       }

       // Cleanup ao sair da página
       window.addEventListener('beforeunload', function(e) {
           if (chatState.step > 1 && !chatState.analysisComplete) {
               e.preventDefault();
               e.returnValue = 'Sua análise atual será perdida. Tem certeza que deseja sair?';
           }
       });

       // Tratamento de erros globais
       window.addEventListener('error', function(e) {
           console.error('Erro na aplicação:', e.error);
           showNotification('Ocorreu um erro inesperado. Tente recarregar a página.', 'error');
       });
   </script>
</body>
</html>