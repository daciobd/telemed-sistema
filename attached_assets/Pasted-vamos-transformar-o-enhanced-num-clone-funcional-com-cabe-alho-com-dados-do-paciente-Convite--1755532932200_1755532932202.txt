vamos transformar o /enhanced num clone funcional, com:

cabe√ßalho com dados do paciente + ‚ÄúConvite‚Äù, status, cron√¥metro, Iniciar Consulta, Voltar, Formul√°rio (mostrar/ocultar), Largura do painel e Sair

abas Chat | Atendimento | Exames | Receitas (Memed)

formul√°rio com CID-10 (auto-sugest√£o), Conduta, Complexidade, Sinais de Alerta, Salvar e Finalizar

barra inferior do v√≠deo (anexar, screenshot, chat, notifica√ß√µes, Dr. AI, microfone, v√≠deo, Sala de espera, Encerrar)

painel ‚ÄúDr. AI‚Äù acoplado ao bot√£o do c√©rebro

Memed abrindo em nova aba (demo) + lista de receitas do atendimento

Abaixo est√£o os arquivos completos. √â s√≥ colar.

1) Substitua server/public/enhanced-consultation.html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Consulta Avan√ßada ‚Ä¢ TeleMed</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#9ca3af;
  --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444; --info:#3b82f6;
  --card:#0b1220; --card2:#0b1322; --ring:rgba(59,130,246,.35);
  --chip:#0b213d; --line:rgba(255,255,255,.08); --brand:#60a5fa;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;background:#0a0f1a;color:var(--ink)}
.app{display:flex; height:100vh; width:100vw; overflow:hidden}

/* ===== topo ===== */
.top{
  position:sticky; top:0; z-index:30;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:10px 14px; background:#0b1322; border-bottom:1px solid var(--line)
}
.pinfo{display:flex; align-items:center; gap:10px}
.avatar{width:28px;height:28px;border-radius:999px;background:#1f2937;display:grid;place-items:center;font-weight:700}
.pmeta{display:flex; gap:12px; color:var(--muted); font-size:12px}
.badge{font-size:12px; padding:4px 8px; border-radius:999px; background:#0b213d; border:1px solid var(--line)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:10px;border:1px solid var(--line);cursor:pointer;background:#0e1629;color:var(--ink)}
.btn:hover{border-color:var(--ring)}
.btn.green{background:#0b2a16;border-color:#14532d;color:#86efac}
.btn.blue{background:#0b213d;border-color:#1e40af;color:#93c5fd}
.btn.red{background:#2a0b0b;border-color:#7f1d1d;color:#fca5a5}
.btn.yellow{background:#2a210b;border-color:#854d0e;color:#fde68a}
.stat{display:flex; align-items:center; gap:10px}
.dot{width:8px;height:8px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 3px rgba(34,197,94,.15)}
.timer{font-variant-numeric:tabular-nums;color:var(--muted);font-size:12px}

/* ===== layout principal ===== */
.main{display:flex; flex:1; min-height:0}

/* v√≠deo √† esquerda */
.left{flex:1.6; min-width:0; position:relative; background:radial-gradient(1200px 600px at -20% 120%, #091226, #0b1220)}
.wait{position:absolute; inset:0; display:grid; place-items:center; color:#cbd5e1}
.wait .cam{font-size:48px; opacity:.2}
.room{position:absolute; bottom:16px; left:18px; font-size:12px; color:#9ca3af}
.badgeOn{display:inline-flex;align-items:center;gap:6px;background:#052e16;color:#86efac;border:1px solid #14532d;padding:4px 8px;border-radius:999px}

/* cron√¥metro no canto */
.clock{position:absolute; top:14px; right:14px; background:#0b213d; padding:6px 10px; border-radius:10px; color:#cbd5e1; font-variant-numeric:tabular-nums}

/* toolbar inferior */
.toolbar{
  position:absolute; left:50%; bottom:16px; transform:translateX(-50%);
  display:flex; gap:12px; background:#0b1322; padding:10px 12px; border:1px solid var(--line); border-radius:999px
}
.ico{width:38px;height:38px;border-radius:999px;background:#0e1629;display:grid;place-items:center;cursor:pointer;border:1px solid var(--line)}
.ico:hover{border-color:var(--ring)}
.ico.red{background:#2a0b0b; color:#fecaca; border-color:#7f1d1d}
.ico.yellow{background:#2a210b; color:#fde68a; border-color:#854d0e}
.badge1{position:absolute; transform:translate(12px,-12px); background:#ef4444; color:white; font-size:10px; padding:2px 5px; border-radius:999px}

/* painel direito */
.right{
  width:480px; max-width:48vw; min-width:360px;
  border-left:1px solid var(--line); background:#0b1322; display:flex; flex-direction:column; min-height:0
}
.tabs{display:flex; gap:8px; padding:10px; border-bottom:1px solid var(--line)}
.tab{padding:8px 12px; border-radius:8px; background:#0e1629; color:#cbd5e1; cursor:pointer}
.tab.active{background:#0b213d; color:#93c5fd; border:1px solid #1e3a8a}
.pane{flex:1; overflow:auto; padding:12px}

/* chat */
.msgs{display:flex;flex-direction:column;gap:8px}
.bubble{max-width:70%; padding:10px 12px; border-radius:12px; background:#111827}
.bubble.me{margin-left:auto;background:#1d4ed8;color:white}
.chatin{display:flex; gap:8px; margin-top:10px}
.text{flex:1; padding:10px 12px; background:#0e1629; border:1px solid var(--line); border-radius:10px; color:var(--ink)}
.send{padding:0 14px}

/* atendimento (form) */
.form .row{margin-bottom:12px}
.label{font-size:12px; color:var(--muted); margin-bottom:6px}
.input, .textarea, .select{
  width:100%; padding:10px 12px; background:#0e1629; border:1px solid var(--line); border-radius:10px; color:var(--ink)
}
.textarea{min-height:80px; resize:vertical}
.req::after{content:" *"; color:#f87171}
.segment{display:flex; gap:8px; margin-bottom:10px}
.segtab{flex:1; padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#0e1629; text-align:center; cursor:pointer}
.segtab.active{background:#0b213d; border-color:#1e40af; color:#93c5fd}
.switch{display:flex; align-items:center; gap:10px; margin:6px 0}
.sw{width:42px;height:22px;background:#0e1629;border:1px solid var(--line);border-radius:999px;position:relative;cursor:pointer}
.sw::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:999px;background:#374151;transition:.15s}
.sw.on{background:#052e16;border-color:#14532d}
.sw.on::after{left:22px;background:#22c55e}
.actions{display:flex; gap:10px; margin-top:10px}

/* exames */
.card{background:#0e1629;border:1px solid var(--line);border-radius:10px;padding:12px}
.list{display:grid; gap:8px}
.add{background:#0b213d;border:1px solid #1e40af;color:#bfdbfe;padding:10px;border-radius:10px;cursor:pointer}
.empty{border:1px dashed var(--line); border-radius:10px; display:grid; place-items:center; padding:24px; color:var(--muted)}

/* receitas (Memed) */
.rxHead{display:flex; align-items:center; justify-content:space-between; gap:10px}
.rxBtn{background:#1d4ed8;color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
.rxItem{background:#0e1629;border:1px solid var(--line);border-radius:10px;padding:10px 12px}
.kicker{font-size:12px;color:var(--muted)}

/* Dr.AI painel */
#aipanel{
  position:fixed; right:16px; bottom:16px; width:360px; max-width:90vw;
  background:#0b1322; border:1px solid var(--line); border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.35); display:none; flex-direction:column; z-index:50
}
.ahead{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--line)}
.acontent{padding:12px; max-height:45vh; overflow:auto; display:flex; flex-direction:column; gap:8px}
.afoot{display:flex; gap:8px; padding:12px; border-top:1px solid var(--line)}
.disclaimer{font-size:12px;color:#a3a3a3; padding:0 12px 8px}
.small{font-size:12px;color:var(--muted)}
.hidden{display:none}

/* util */
hr.sep{border:none;border-top:1px solid var(--line);margin:10px 0}
</style>
</head>
<body>
<div class="app">
  <div class="main">

    <!-- COLUNA V√çDEO -->
    <section class="left" id="videoArea">
      <div class="clock" id="clock">00:00</div>
      <div class="wait">
        <div>
          <div class="cam">üì∑</div>
          <div style="text-align:center;margin-top:8px;color:#9ca3af">Aguardando paciente‚Ä¶</div>
          <div class="room">
            <span class="badgeOn"><span style="width:8px;height:8px;border-radius:999px;background:#22c55e"></span>Conectado</span>
            <div style="margin-top:6px;color:#9ca3af">Sala: #ABC123</div>
          </div>
        </div>
      </div>

      <!-- barra inferior -->
      <div class="toolbar">
        <div class="ico" title="Anexar (arquivo)"><input id="fileup" type="file" multiple class="hidden"><span>üìé</span></div>
        <div class="ico" id="btnShot" title="Captura de tela"><span>üì∑</span></div>
        <div class="ico" id="btnOpenChat" title="Abrir Chat"><span>üí¨</span></div>
        <div class="ico" id="btnBell" title="Notifica√ß√µes"><span>üîî</span><span class="badge1" id="bellN" style="display:none">1</span></div>
        <div class="ico" id="btnAI" title="Dr. AI (orienta√ß√£o)"><span>üß†</span></div>
        <div class="ico" id="btnMic" title="Mic on/off"><span>üéôÔ∏è</span></div>
        <div class="ico" id="btnCam" title="V√≠deo on/off"><span>üé•</span></div>
        <div class="ico yellow" id="btnHold" title="Enviar p/ sala de espera"><span>‚è∏Ô∏è</span></div>
        <div class="ico red" id="btnEnd" title="Encerrar"><span>‚õî</span></div>
      </div>
    </section>

    <!-- COLUNA DIREITA -->
    <section class="right" id="rightPane">
      <!-- topo secund√°rio -->
      <div class="top">
        <div class="pinfo">
          <div class="avatar">CF</div>
          <div>
            <div style="font-weight:600">Ana Costa Silva <span class="badge">Particular</span></div>
            <div class="pmeta">
              <span>üìû 11 98765-4321</span><span>‚Ä¢</span><span>0 anos</span>
              <button class="btn blue" id="btnInvite">Convite</button>
            </div>
          </div>
        </div>
        <div class="stat">
          <span class="dot" id="statusDot"></span>
          <span class="timer" id="since">Aguardando</span>
          <button class="btn green" id="btnStart">‚ñ∂ Iniciar Consulta</button>
          <button class="btn" id="btnBack">‚Üê Voltar</button>
          <button class="btn" id="btnToggleForm">Formul√°rio</button>
          <button class="btn" id="btnW">Largura</button>
          <button class="btn red" id="btnExit">Sair</button>
        </div>
      </div>

      <!-- abas -->
      <div class="tabs">
        <div class="tab" data-tab="chat">üí¨ Chat</div>
        <div class="tab active" data-tab="care">ü©∫ Atendimento</div>
        <div class="tab" data-tab="exams">üß™ Exames</div>
        <div class="tab" data-tab="rx">üíä Receitas</div>
      </div>

      <!-- panes -->
      <div class="pane" id="pane-chat" style="display:none">
        <div class="msgs" id="msgs">
          <div class="bubble">Ol√°, doutor! Como est√°?</div>
          <div class="bubble me">Ol√°! Estou bem, obrigado. Como posso ajud√°-lo hoje?</div>
          <div class="bubble">Sinto dores de cabe√ßa frequentes‚Ä¶</div>
        </div>
        <div class="chatin">
          <input id="msg" class="text" placeholder="Digite sua mensagem‚Ä¶"/>
          <button class="btn send" id="send">Enviar</button>
        </div>
      </div>

      <div class="pane form" id="pane-care">
        <div class="row">
          <div class="label req">Queixa Principal</div>
          <textarea id="field-qp" class="textarea" placeholder="Motivo da consulta"></textarea>
        </div>
        <div class="row">
          <div class="label req">Hist√≥ria da Doen√ßa Atual</div>
          <textarea id="field-hda" class="textarea" placeholder="Evolu√ß√£o dos sintomas"></textarea>
        </div>

        <div class="row">
          <div class="label req">Hip√≥tese Diagn√≥stica / CID-10</div>
          <input id="cidInput" class="input" list="cidlist" placeholder="Digite CID">
          <datalist id="cidlist"></datalist>
        </div>

        <div class="segment">
          <div class="segtab active" data-seg="cond">Conduta</div>
          <div class="segtab" data-seg="exams">Exames</div>
          <div class="segtab" data-seg="memed">MedMed</div>
        </div>

        <div id="seg-cond">
          <div class="row">
            <div class="label req">Conduta Terap√™utica</div>
            <textarea id="field-cond" class="textarea" placeholder="Orienta√ß√µes e tratamento"></textarea>
          </div>
          <div class="row">
            <div class="label">Complexidade</div>
            <div class="switch"><div class="sw" id="sw-grave"></div> Agravo em sa√∫de mental</div>
            <div class="switch"><div class="sw" id="sw-compl"></div> Complexidade cl√≠nica</div>
            <div class="switch"><div class="sw" id="sw-inc"></div> Inconsist√™ncia de queixas</div>
          </div>
          <div class="row">
            <div class="label">Sinais de Alerta</div>
            <input id="field-alert" class="input" placeholder="Ex: idea√ß√£o suicida, dor tor√°cica‚Ä¶">
          </div>
          <div class="actions">
            <button class="btn blue" id="btnSave">üíæ Salvar Atendimento</button>
            <button class="btn red" id="btnFinish">‚úî Finalizar Consulta</button>
          </div>
        </div>

        <div id="seg-exams" class="hidden">
          <div class="card">
            <div class="label">Templates Comuns</div>
            <div class="list" id="tplList">
              <div class="rxItem" data-name="Hemograma completo" data-rotina="Jejum de 8‚Äì12 horas">Hemograma completo <div class="kicker">Jejum de 8‚Äì12 horas</div></div>
              <div class="rxItem" data-name="Glicemia de jejum" data-rotina="Jejum rigoroso de 8‚Äì12 horas">Glicemia de jejum <div class="kicker">Jejum rigoroso de 8‚Äì12 horas</div></div>
            </div>
          </div>
          <div class="row"><div class="label">Nome do exame</div><input id="ex-name" class="input"></div>
          <div class="row"><div class="label">Rotina</div>
            <select id="ex-prio" class="select">
              <option>Rotina</option><option>Priorit√°rio</option><option>Urgente</option>
            </select>
          </div>
          <div class="row"><div class="label">Instru√ß√µes espec√≠ficas</div><textarea id="ex-notes" class="textarea"></textarea></div>
          <button class="add" id="addExam">+ Adicionar Exame</button>
          <div class="row">
            <div class="label">Solicita√ß√µes</div>
            <div id="examList" class="empty">Nenhum exame solicitado</div>
          </div>
        </div>

        <div id="seg-memed" class="hidden">
          <div class="card">
            <div class="rxHead">
              <div>
                <div style="font-weight:600">Integra√ß√£o MedMed</div>
                <div class="kicker">Base farmacol√≥gica, assinatura digital ICP-Brasil, verifica√ß√£o de intera√ß√µes.</div>
              </div>
              <button class="rxBtn" id="openMemed">Nova Receita MedMed</button>
            </div>
          </div>
          <div class="row">
            <div class="label">Receitas do Atendimento</div>
            <div id="rxList" class="empty">Nenhuma receita ainda</div>
          </div>
        </div>
      </div>

      <div class="pane" id="pane-exams" style="display:none">
        <div class="card">
          <div class="label">Atalho</div>
          <div class="kicker">Use a aba ‚ÄúAtendimento ‚Üí MedMed‚Äù para prescrever.</div>
        </div>
      </div>

      <div class="pane" id="pane-rx" style="display:none">
        <div class="card">
          <div class="rxHead">
            <div>
              <div style="font-weight:600">Integra√ß√£o MedMed</div>
              <div class="kicker">Clique abaixo para abrir a prescri√ß√£o em nova aba.</div>
            </div>
            <button class="rxBtn" id="openMemed2">Nova Receita MedMed</button>
          </div>
        </div>
        <div class="row"><div class="label">Receitas do Atendimento</div><div id="rxList2" class="empty">Nenhuma receita ainda</div></div>
      </div>
    </section>
  </div>
</div>

<!-- Painel Dr.AI -->
<div id="aipanel">
  <div class="ahead"><div>üß† <b>Dr. AI</b></div><button class="btn red" id="aiClose">Fechar</button></div>
  <div class="disclaimer">As respostas s√£o apoio √† decis√£o e <b>n√£o substituem</b> o julgamento cl√≠nico.</div>
  <div class="acontent" id="aiMsgs">
    <div class="bubble">Como posso ajudar?</div>
  </div>
  <div class="afoot">
    <input id="aiText" class="text" placeholder="Digite sua pergunta cl√≠nica‚Ä¶">
    <button class="btn blue" id="aiSend">Enviar</button>
  </div>
</div>

<script>
/* ===== util ===== */
const $ = (q) => document.querySelector(q);
const $$ = (q) => Array.from(document.querySelectorAll(q));
const toast = (t) => { console.log('TOAST:', t); };

/* ===== timer ===== */
let secs = 0;
setInterval(()=>{ secs++; const m=String(Math.floor(secs/60)).padStart(2,'0'); const s=String(secs%60).padStart(2,'0'); $('#clock').textContent=`${m}:${s}` }, 1000);

/* ===== topo: a√ß√µes ===== */
$('#btnBack').onclick = () => history.back();
$('#btnExit').onclick = () => location.href = '/';
let formVisible = true;
$('#btnToggleForm').onclick = () => {
  const rp = $('#rightPane');
  formVisible = !formVisible;
  rp.style.display = formVisible ? 'flex' : 'none';
};
let widths = [360, 480, 640], wi=1;
$('#btnW').onclick = () => {
  wi = (wi+1)%widths.length;
  const w = widths[wi];
  const rp = $('#rightPane');
  rp.style.width = w+'px';
};

/* ===== tabs ===== */
function setTab(name){
  $$('.tab').forEach(el => el.classList.toggle('active', el.dataset.tab===name));
  $('#pane-chat').style.display   = name==='chat'?'block':'none';
  $('#pane-care').style.display   = name==='care'?'block':'none';
  $('#pane-exams').style.display  = name==='exams'?'block':'none';
  $('#pane-rx').style.display     = name==='rx'?'block':'none';
}
$$('.tab').forEach(el => el.onclick = () => setTab(el.dataset.tab));

/* ===== segment (conduta/exames/memed dentro do atendimento) ===== */
function setSeg(id){
  $$('.segtab').forEach(s=>s.classList.toggle('active', s.dataset.seg===id));
  $('#seg-cond').classList.toggle('hidden', id!=='cond');
  $('#seg-exams').classList.toggle('hidden', id!=='exams');
  $('#seg-memed').classList.toggle('hidden', id!=='memed');
}
$$('.segtab').forEach(s => s.onclick = () => setSeg(s.dataset.seg));

/* ===== switches ===== */
$$('.sw').forEach(sw => sw.onclick = () => sw.classList.toggle('on'));

/* ===== CID10 autosuggest ===== */
const localCid = [
  "F41.1 ‚Äì Transtorno de ansiedade generalizada",
  "G43.0 ‚Äì Enxaqueca sem aura",
  "J00 ‚Äì Nasofaringite aguda (resfriado)",
  "I10 ‚Äì Hipertens√£o essencial (prim√°ria)",
  "E11 ‚Äì Diabetes mellitus tipo 2"
];
async function loadCid(q){
  try{
    const r = await fetch(`/api/cid10?q=${encodeURIComponent(q)}`);
    if(!r.ok) throw 0;
    const list = await r.json();
    return list.length? list : localCid.filter(x => x.toLowerCase().includes(q.toLowerCase()));
  }catch{ return localCid.filter(x => x.toLowerCase().includes(q.toLowerCase())); }
}
$('#cidInput').addEventListener('input', async e => {
  const q = e.target.value.trim(); if(q.length<2) return;
  const opts = await loadCid(q);
  const dl = $('#cidlist'); dl.innerHTML='';
  opts.slice(0,50).forEach(x => {
    const o = document.createElement('option'); o.value=x; dl.appendChild(o);
  });
});

/* ===== exames ===== */
const examStore = [];
function renderExams(){
  const wrap = $('#examList');
  if(!examStore.length){ wrap.className='empty'; wrap.textContent='Nenhum exame solicitado'; return; }
  wrap.className='list';
  wrap.innerHTML='';
  examStore.forEach((e,i)=>{
    const d = document.createElement('div');
    d.className='rxItem';
    d.innerHTML = `<b>${e.name}</b> <div class="kicker">${e.prio}${e.notes?` ‚Ä¢ ${e.notes}`:''}</div>`;
    wrap.appendChild(d);
  });
}
$('#tplList').addEventListener('click', e=>{
  const el = e.target.closest('.rxItem'); if(!el) return;
  $('#ex-name').value = el.dataset.name;
  $('#ex-notes').value = el.dataset.rotina;
});
$('#addExam').onclick = ()=>{
  const name = $('#ex-name').value.trim(); if(!name) return;
  const prio = $('#ex-prio').value;
  const notes = $('#ex-notes').value.trim();
  examStore.push({name, prio, notes});
  renderExams(); $('#ex-name').value=''; $('#ex-notes').value='';
};

/* ===== Memed ===== */
function patientDemo(){
  return { name:"Ana Costa Silva", age:"0", phone:"11987654321" }
}
function memedUrl(){
  const p = patientDemo();
  return `https://memed.com.br/?demo=1&patient=${encodeURIComponent(JSON.stringify(p))}`;
}
const rxStore = JSON.parse(localStorage.getItem('telemed_rx')||'[]');
function saveRx(){ localStorage.setItem('telemed_rx', JSON.stringify(rxStore)); }
function renderRx(){
  const containers = [$('#rxList'), $('#rxList2')];
  containers.forEach(wrap=>{
    if(!rxStore.length){ wrap.className='empty'; wrap.textContent='Nenhuma receita ainda'; return; }
    wrap.className='list'; wrap.innerHTML='';
    rxStore.forEach(r=>{
      const d = document.createElement('div');
      d.className='rxItem';
      d.innerHTML = `<div><b>Receita #${r.code}</b> <span class="badge">Assinada</span></div>
                     <div class="kicker">${r.drug} ‚Ä¢ ${r.sig}</div>`;
      wrap.appendChild(d);
    });
  });
}
function addDemoRx(){
  const code = Math.random().toString(36).slice(2,9).toUpperCase();
  rxStore.unshift({code, drug:"Dipirona s√≥dica 500 mg", sig:"1 comprimido se dor ou febre ‚Ä¢ 20 cp"});
  saveRx(); renderRx();
}
$('#openMemed').onclick = ()=>{ window.open(memedUrl(), '_blank'); setTimeout(addDemoRx, 1200); };
$('#openMemed2').onclick = ()=>{ window.open(memedUrl(), '_blank'); setTimeout(addDemoRx, 1200); };
renderRx();

/* ===== Chat simples ===== */
$('#send').onclick = ()=>{
  const v = $('#msg').value.trim(); if(!v) return;
  const b = document.createElement('div'); b.className='bubble me'; b.textContent=v; $('#msgs').appendChild(b); $('#msg').value='';
  $('#msgs').scrollTop = 1e9;
};

/* ===== Dr.AI ===== */
function toggleAI(show){ $('#aipanel').style.display = show?'flex':'none'; }
$('#btnAI').onclick = ()=> toggleAI(true);
$('#aiClose').onclick = ()=> toggleAI(false);
$('#aiSend').onclick = async ()=>{
  const t = $('#aiText').value.trim(); if(!t) return;
  const add = (txt, me)=>{ const d=document.createElement('div'); d.className='bubble'+(me?' me':''); d.textContent=txt; $('#aiMsgs').appendChild(d); $('#aiMsgs').scrollTop=1e9; };
  add(t, true); $('#aiText').value='';
  try{
    const r = await fetch('/api/ai/doctor', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:t, page:'enhanced'})});
    if(!r.ok) throw 0; const j = await r.json(); add(j.answer || 'OK');
  }catch{ add('Sugest√£o: confirmar sinais de alarme, avaliar necessidade de exame f√≠sico e medir PA.'); }
};

/* ===== topo: start/save/finalize/invite ===== */
$('#btnStart').onclick = async ()=>{
  try{ await fetch('/api/consults/ABC123/start',{method:'POST'}); }catch{}
  $('#since').textContent='Em atendimento';
  toast('Consulta iniciada');
};
$('#btnSave').onclick = async ()=>{
  const payload = {
    qp:$('#field-qp').value, hda:$('#field-hda').value, cid:$('#cidInput').value,
    cond:$('#field-cond').value, alert:$('#field-alert').value,
    flags:{grave:$('#sw-grave').classList.contains('on'), compl:$('#sw-compl').classList.contains('on'), inc:$('#sw-inc').classList.contains('on')},
    exams:examStore, rx:rxStore
  };
  try{ await fetch('/api/consults/ABC123/notes',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});}catch{}
  toast('Atendimento salvo');
};
$('#btnFinish').onclick = async ()=>{
  try{ await fetch('/api/consults/ABC123/finalize',{method:'POST'});}catch{}
  alert('Consulta finalizada!');
};
$('#btnInvite').onclick = async ()=>{
  try{ await fetch('/api/consults/ABC123/invite',{method:'POST'});}catch{}
  const b = $('#bellN'); b.style.display='inline-block';
  toast('Convite enviado para a sala de espera');
};

/* ===== barra v√≠deo ===== */
$('#btnOpenChat').onclick = ()=> setTab('chat');
$('#btnShot').onclick = ()=> toast('Screenshot salvo (demo)');
let micOn=true, camOn=true;
$('#btnMic').onclick = ()=>{ micOn=!micOn; $('#btnMic').style.opacity = micOn?1:.5; };
$('#btnCam').onclick = ()=>{ camOn=!camOn; $('#btnCam').style.opacity = camOn?1:.5; };
$('#btnHold').onclick = ()=>{ $('#since').textContent='Em espera'; toast('Paciente enviado √† sala de espera (demo)'); };
$('#btnEnd').onclick = ()=>{ if(confirm('Encerrar a chamada?')) toast('Chamada encerrada (demo)'); };
</script>
</body>
</html>

2) Acrescente (ou confirme) os endpoints no server/index.ts

Coloque estes stubs (funcionam para o front e voc√™ pode ligar √† sua base depois). Procure o bloco onde voc√™ registra as rotas e acrescente:

// --- Enhanced: APIs simples para o front ---
app.post('/api/consults/:id/start', (req,res)=> {
  console.log('START', req.params.id); return res.json({ok:true, startedAt:Date.now()});
});
app.post('/api/consults/:id/notes', express.json(), (req,res)=> {
  console.log('SAVE', req.params.id, req.body?.qp?.slice?.(0,60));
  return res.json({ok:true});
});
app.post('/api/consults/:id/finalize', (req,res)=> {
  console.log('FINALIZE', req.params.id); return res.json({ok:true});
});
app.post('/api/consults/:id/invite', (req,res)=> {
  console.log('INVITE', req.params.id); return res.json({ok:true, delivered:true});
});

// CID-10 autosugest√£o (usa lista carregada na mem√≥ria se voc√™ j√° tem; aqui um fallback curto)
const CID_LOCAL = [
  'F41.1 ‚Äì Transtorno de ansiedade generalizada',
  'G43.0 ‚Äì Enxaqueca sem aura',
  'J00 ‚Äì Nasofaringite aguda (resfriado)',
  'I10 ‚Äì Hipertens√£o essencial (prim√°ria)',
  'E11 ‚Äì Diabetes mellitus tipo 2',
];
app.get('/api/cid10', (req,res)=>{
  const q = String(req.query.q||'').toLowerCase();
  const list = CID_LOCAL.filter(x=>x.toLowerCase().includes(q));
  res.json(list);
});

// Dr.AI (demonstra√ß√£o); troque para seu endpoint real quando quiser
app.post('/api/ai/doctor', express.json(), async (req,res)=>{
  const q = String(req.body?.message||'');
  // aqui voc√™ poderia chamar seu cliente OpenAI / modelo interno
  const mock = `Para "${q}", considere sinais de alarme, fatores de risco e exames direcionados.`;
  res.json({answer: mock});
});


Observa√ß√£o: o seu servidor j√° est√° servindo o HTML dedicado (os logs ‚Äú‚úÖ Servindo enhanced-consultation.html dedicado‚Äù confirmam). S√≥ substituir o arquivo e reiniciar.

O que ficou pronto agora

Cabe√ßalho completo com Convite, status/cron√¥metro, Iniciar, Voltar, Formul√°rio, Largura, Sair

Abas Chat / Atendimento / Exames / Receitas

CID-10 com auto-sugest√£o (endpoint + fallback local)

Exames com templates, prioridades e lista

Memed: bot√£o ‚ÄúNova Receita MedMed‚Äù abre memed.com.br (modo demo) com os dados do paciente; ao voltar, a lista ‚ÄúReceitas do Atendimento‚Äù aparece preenchida (mock)

Barra de v√≠deo com todos os bot√µes solicitados (inclui Dr. AI que abre o painel lateral)

Salvar e Finalizar batendo em endpoints stubs

Painel Dr. AI com ressalva de que √© apoio √† decis√£o